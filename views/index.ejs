<% layout('layouts/boilerplate') %>

<%
  // ✅ Set SEO variables for the boilerplate to render inside its <head>
  title = "PetVoyage - Pet Travel Regulations and Airline Policies";
  metaDescription = "Your ultimate free resource for pet policies across countries and airlines. Find pet travel regulations, airline pet policies, and international pet import/export rules.";
  metaKeywords = "pet travel regulations, airline pet policies, pet import requirements, pet travel rules, pet policies by country, travel with pets, international pet travel, pet rules for airlines, pet import export rules, travel pet documents";

  ogTitle = title;
  ogDescription = metaDescription;
  ogImage = "https://www.petvoyage.ai/images/PetVoyageLogo.png";
  ogUrl = "https://www.petvoyage.ai";

  twitterTitle = title;
  twitterDescription = metaDescription;
  twitterImage = ogImage;
%>

<!-- Hero + Side Panels Row -->
<section class="bg-light py-5 border-bottom">
  <div class="container-fluid px-lg-5">
    <div class="row g-4 align-items-start">

      <!-- LEFT (DESKTOP): Blog + Tips -->
      <aside class="col-lg-3 d-none d-lg-block">
        <!-- Blog Card -->
        <a href="/blog" class="text-decoration-none">
          <div class="card h-100 border-0 shadow-sm mb-4">
            <img src="/images/movetocdmx.jpg" class="card-img-top" alt="PetVoyage Blog preview" loading="lazy">
            <div class="card-body">
              <h6 class="text-muted mb-2">Featured on the Blog</h6>
              <h5 class="card-title mb-2">How We Moved to Mexico City With Our Pets</h5>
              <p class="card-text small text-muted mb-3">
                Flight prep, airline choice, vet visits, and what actually worked the day we flew…
              </p>
              <span class="btn btn-outline-secondary btn-sm">Read the story</span>
            </div>
          </div>
        </a>

        <!-- Tips Card -->
        <a href="/tips" class="text-decoration-none">
          <div class="card h-100 border-0 shadow-sm">
            <img src="/images/Bird2.png" class="card-img-top" alt="PetVoyage Tips preview" loading="lazy">
            <div class="card-body">
              <h6 class="text-muted mb-2">Featured Tip</h6>
              <h5 class="card-title mb-2">Top 5 Tricks for Stress-Free Pet Travel</h5>
              <p class="card-text small text-muted mb-3">
                Quick and effective tips to make flying with your furry friend easier than ever…
              </p>
              <span class="btn btn-outline-secondary btn-sm">Read tips</span>
            </div>
          </div>
        </a>
      </aside>

      <!-- CENTER -->
      <div class="col-lg-6 text-center">
        <img
          src="/images/PetVoyageLogo.png"
          class="img-fluid rounded-top d-block mx-auto mb-3"
          alt="PetVoyage Logo - Pet Travel Regulations and Policies"
          width="400"
          height="400"
        />
        <h1 class="fw-bold display-5">Travel Smarter with Pets</h1>
        <p class="fs-5 text-muted">Instantly explore pet policies by airline and country. Fly with peace of mind.</p>

        <div>
          <%- include('./partials/navigation') %>
        </div>

        <div class="container py-4">
          <%- include('partials/chatGPTIndex', { idSuffix: 'home' }) %>
        </div>

        <!-- Full-screen loading overlay -->
        <div id="loadingOverlay"
             style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;
                    background:rgba(255,255,255,0.9);z-index:9999;
                    backdrop-filter:blur(3px);text-align:center;">
          <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);">
            <div class="spinner-border text-primary" role="status" style="width:4rem;height:4rem;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 fs-5 text-primary">Searching for regulations…</p>
          </div>
        </div>

        <!-- MOBILE-ONLY: Blog Card -->
        <div class="d-lg-none">
          <div class="row g-3 mt-4">
            <div class="col-12">
              <a href="/blog" class="text-decoration-none">
                <div class="card border-0 shadow-sm">
                  <img src="/images/movetocdmx.jpg" class="card-img-top" alt="PetVoyage Blog preview" loading="lazy">
                  <div class="card-body">
                    <h6 class="text-muted mb-2">Featured on the Blog</h6>
                    <h5 class="card-title mb-2">How We Moved to Mexico City With Our Pets</h5>
                    <p class="card-text small text-muted mb-3">Flight prep, airline choice, vet visits, and what actually worked the day we flew…</p>
                    <span class="btn btn-outline-secondary btn-sm">Read the story</span>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </div>

        <!-- SHOP CAROUSEL -->
        <div class="shop-inline mt-4">
          <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
            <h5 class="m-0 fw-bold">Top Must-Have Travel Products</h5>
            <a href="https://petsvoyage.myshopify.com/collections/must-have-products-to-fly-with-your-pet" class="btn btn-outline-secondary btn-sm">View all</a>
          </div>

          <div class="shop-carousel">
            <button class="shop-nav prev" aria-label="Previous">&#10094;</button>
            <div class="shop-track">
              <%- include('./partials/ads/dogFullCollections', {
                componentId: 'pv-inline-collection-home',
                collectionId: '320667189420',
                title: 'Top Must-Have Travel Products',
                viewAllHref: '/shop'
              }) %>
            </div>
            <button class="shop-nav next" aria-label="Next">&#10095;</button>
          </div>
        </div>

        <!-- MOBILE-ONLY: Tips + To-Do -->
        <div class="d-lg-none">
          <div class="row g-3 mt-4">
            <div class="col-12">
              <a href="/tips" class="text-decoration-none">
                <div class="card border-0 shadow-sm">
                  <img src="/images/Bird2.png" class="card-img-top" alt="PetVoyage Tips preview" loading="lazy">
                  <div class="card-body">
                    <h6 class="text-muted mb-2">Featured Tip</h6>
                    <h5 class="card-title mb-2">Top 5 Tricks for Stress-Free Pet Travel</h5>
                    <p class="card-text small text-muted mb-3">Quick and effective tips to make flying with your furry friend easier than ever…</p>
                    <span class="btn btn-outline-secondary btn-sm">Read tips</span>
                  </div>
                </div>
              </a>
            </div>
          </div>

          <!-- MOBILE: Ad Card -->
          <div class="mt-4">
            <a href="https://petsvoyage.myshopify.com" class="text-decoration-none" target="_blank">
              <div class="card border-0 shadow-sm">
                <!-- ✅ FIXED: missing .jpg -->
                <img src="/images/DogTravelCollectionV2.jpg"
                     class="card-img-top"
                     alt="Pet Travel Supplies"
                     loading="lazy">
                <div class="card-body">
                  <h6 class="text-muted mb-2">Shop Pet Travel Essentials</h6>
                  <h5 class="card-title mb-2">Stress-Free Travel Starts Here</h5>
                  <p class="card-text small text-muted mb-3">
                    Airline-approved carriers, crates, harnesses, and TSA-friendly travel kits for your pet’s safe journey.
                  </p>
                  <span class="btn btn-primary btn-sm">Shop Now →</span>
                </div>
              </div>
            </a>
          </div>

          <!-- To-Do (mobile bottom) -->
          <div class="card border-0 shadow-sm mt-4">
            <div class="card-body p-3">
              <%- include('./partials/toDoList') %>
            </div>
          </div>
        </div>
      </div><!-- /CENTER -->

      <!-- RIGHT (DESKTOP): Pet Supplies Ad + To-Do -->
      <aside class="col-lg-3 d-none d-lg-block">
        <div class="sticky-lg-top" style="top:1.5rem">

          <!-- Pet Supplies Ad Card -->
          <a href="https://petsvoyage.myshopify.com/collections/all?filter.v.price.gte=&filter.v.price.lte=&filter.p.t.category=ap&sort_by=best-selling" class="text-decoration-none" target="_blank">
            <div class="card h-100 border-0 shadow-sm mb-4">
              <img src="/images/DogTravelCollectionV2.jpg"
                   class="card-img-top"
                   alt="Pet Travel Supplies"
                   loading="lazy">
              <div class="card-body">
                <h6 class="text-muted mb-2">Shop Pet Travel Essentials</h6>
                <h5 class="card-title mb-2">Stress-Free Travel Starts Here</h5>
                <p class="card-text small text-muted mb-3">
                  Airline-approved carriers, crates, harnesses, travel medical kits, and more.
                </p>
                <span class="btn btn-primary btn-sm">Shop Now →</span>
              </div>
            </div>
          </a>

          <!-- To-Do List Card -->
          <div class="card border-0 shadow-sm">
            <div class="card-body p-3">
              <%- include('./partials/toDoList') %>
            </div>
          </div>
        </div>
      </aside>

    </div>
  </div>
</section>






<!-- Scripts -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const chatButton = document.getElementById('ai-chat-button');
    const chatPopup = document.getElementById('ai-chat-popup');
    const askQuestionForm = document.getElementById('ask-question-form');
    const aiAnswerContainer = document.getElementById('ai-answer-container');
    const aiAnswer = document.getElementById('ai-answer');

    chatButton.addEventListener('click', () => {
      chatPopup.style.display = (chatPopup.style.display === 'none' || chatPopup.style.display === '') ? 'block' : 'none';
    });

    askQuestionForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const userQuestion = document.getElementById('user_question').value;

      try {
        const response = await fetch('/ask-question', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_question: userQuestion })
        });
        const result = await response.json();
        aiAnswerContainer.style.display = 'block';
        aiAnswer.textContent = result.answer;
      } catch (error) {
        console.error('Error fetching AI answer:', error);
        aiAnswerContainer.style.display = 'block';
        aiAnswer.textContent = 'An error occurred. Please try again.';
      }
    });
  });

  // Bootstrap tooltips
  $(function () { $('[data-bs-toggle="tooltip"]').tooltip(); });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector('form[action="/flights/searchFlights"]');
    const overlay = document.getElementById("loadingOverlay");
    if (!form || !overlay) return;

    form.addEventListener("submit", function () {
      // ✅ Show overlay
      overlay.style.display = "block";
      overlay.classList.add("show");

      // ✅ Only disable submit buttons to prevent double-submits
      form.querySelectorAll('button[type="submit"], input[type="submit"]').forEach(btn => {
        btn.disabled = true;
      });

      // ❌ Do NOT disable inputs/selects — hidden fields must still submit!
      // form.querySelectorAll("button, input, select").forEach(el => el.disabled = true); // remove this
    });
  });
</script>

<!-- SHOP CAROUSEL JS (robust flattening) -->
<script>
  (function () {
    // Find likely product cards inside any wrapper
    function findProductCards(container) {
      // common cases
      let cards = container.querySelectorAll(
        '[data-product-id], [data-product], [class*="product-card"], [class*="ProductCard"], a[href*="/products/"]'
      );
      if (cards.length) return Array.from(cards);
  
      // fallback: elements that contain an image + a buy/view button
      cards = Array.from(container.querySelectorAll('*')).filter(el => {
        const hasImg = el.querySelector('img');
        const hasBtn = el.querySelector('button, .btn, a[href*="cart"], a[href*="/products/"]');
        return hasImg && hasBtn && el.children.length > 0;
      });
      return cards;
    }
  
    // Flatten Shopify structure by hoisting product cards to be direct children of the track
    function hoistToTrack(track) {
      // If already flattened, bail
      const direct = findProductCards(track);
      if (direct.length >= 2) return;
  
      // try single wrapper
      if (track.children.length === 1) {
        const only = track.firstElementChild;
        const found = findProductCards(only);
        if (found.length) {
          track.replaceChildren(...found);
          return;
        }
      }
  
      // try scanning descendants
      const wrappers = Array.from(track.querySelectorAll('*')).filter(n => n.children && n.children.length);
      for (const w of wrappers) {
        const found = findProductCards(w);
        if (found.length >= 2) {
          track.replaceChildren(...found);
          return;
        }
      }
    }
  
    function initShopCarousel(root) {
      const track = root.querySelector('.shop-track');
      const prev  = root.querySelector('.shop-nav.prev');
      const next  = root.querySelector('.shop-nav.next');
      if (!track) return;
  
      // Ensure we run after Shopify inserts content (if async)
      const finalize = () => {
        hoistToTrack(track);
        // mark slides (harmless if already flattened)
        Array.from(track.children).forEach(el => el.classList.add('shop-slide'));
  
        const updateArrows = () => {
          const canLeft  = track.scrollLeft > 5;
          const canRight = track.scrollWidth - track.clientWidth - track.scrollLeft > 5;
          if (prev) prev.style.visibility = canLeft  ? 'visible' : 'hidden';
          if (next) next.style.visibility = canRight ? 'visible' : 'hidden';
        };
  
        const scrollByAmt = dir => {
          const amt = Math.round(track.clientWidth * 0.9);
          track.scrollBy({ left: dir * amt, behavior: 'smooth' });
          setTimeout(updateArrows, 250);
        };
  
        prev && prev.addEventListener('click', () => scrollByAmt(-1));
        next && next.addEventListener('click', () => scrollByAmt(1));
        track.addEventListener('scroll', updateArrows);
        new ResizeObserver(updateArrows).observe(track);
  
        // keyboard
        track.tabIndex = 0;
        track.addEventListener('keydown', e => {
          if (e.key === 'ArrowLeft')  scrollByAmt(-1);
          if (e.key === 'ArrowRight') scrollByAmt(1);
        });
  
        updateArrows();
      };
  
      // If content is empty now, watch for inserts then finalize once
      const needObserve = track.querySelectorAll('*').length < 3;
      if (needObserve) {
        const mo = new MutationObserver((muts, obs) => {
          if (track.querySelectorAll('img').length) {
            obs.disconnect();
            finalize();
          }
        });
        mo.observe(track, { childList: true, subtree: true });
        // also finalize after a short delay as a safety net
        setTimeout(finalize, 1200);
      } else {
        finalize();
      }
    }
  
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.shop-carousel').forEach(initShopCarousel);
    });
  })();
  </script>
  
