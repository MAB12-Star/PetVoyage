<% layout('layouts/boilerplate') %>

<div class="container my-4">
  <a class="btn btn-outline-secondary btn-sm mb-3" href="/blog">← Back to stories</a>

  <h1 class="display-6"><%= story.title %></h1>

  <p class="text-muted">
    <%= (story.author && story.author.displayName) || story.authorName || 'Anonymous' %>
    • <%= new Date(story.createdAt).toLocaleDateString() %>

    <% if (story.airline) { %>
      • Airline:
      <% if (airlineDoc && airlineDoc.slug) { %>
        <a href="/airlines/<%= airlineDoc.slug %>" class="text-decoration-none">
          <%= airlineDoc.name %>
        </a>
      <% } else { %>
        <%= story.airline %>
      <% } %>
    <% } %>

    <% 
      const routeText = story.route 
        || ((story.routeFrom || '') + (story.routeTo ? ((story.routeFrom ? ' → ' : '') + story.routeTo) : ''));
      if (routeText) { %>
        • Route: <%= routeText %>
    <% } %>

    <% if (story.petType) { %> • Pet: <%= story.petType %><% } %>
  </p>

  <% if (airlineDoc && airlineDoc.slug) { %>
    <div class="mb-3">
      <a class="btn btn-outline-primary btn-sm"
         href="/airlines/<%= airlineDoc.slug %>">
        View <%= airlineDoc.name %> Pet Policy
      </a>
    </div>
  <% } %>

  <% if (story.photos && story.photos.length) { %>
    <div class="row g-3 mb-3" aria-label="Story photos">
      <% story.photos.forEach(p => { %>
        <div class="col-sm-6 col-lg-4">
          <img src="<%= p.url %>" class="img-fluid rounded"
               alt="<%= p.alt || ('Photo from ' + story.title) %>" loading="lazy">
        </div>
      <% }) %>
    </div>
  <% } %>

  <% if (story.summary) { %>
    <p class="lead"><%= story.summary %></p>
  <% } %>

  <% if (story.body) { %>
    <!-- Use unescaped tag so your stored HTML renders -->
    <div class="mt-3"><%- story.body %></div>
  <% } %>
</div>
