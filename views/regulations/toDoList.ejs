<% layout('layouts/boilerplate') %>

<div class="container mt-5">
    <h1 class="text-center text-primary mb-4">Checklist for Pet Travel</h1>
    <% Object.keys(toDoList).forEach(section => { %>
        <div class="card mb-3 shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h4><%= section %></h4>
            </div>
            <div class="card-body">
                <% Object.keys(toDoList[section]).forEach(task => { %>
                    <div class="form-check">
                        <input
                            class="form-check-input task-checkbox"
                            type="checkbox"
                            data-section="<%= section %>"
                            data-task="<%= task %>"
                            <%= toDoList[section][task] ? 'checked' : '' %>
                        >
                        <label class="form-check-label">
                            <%= task %>
                        </label>
                    </div>
                <% }) %>
            </div>
        </div>
    <% }) %>
</div>

<script>
    document.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function () {
            const section = this.dataset.section;
            const task = this.dataset.task;
            const completed = this.checked;

            fetch('/toDoList/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ section, task, completed }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Task updated successfully');
                } else {
                    alert('Error updating task');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating task');
            });
        });
    });
</script>
