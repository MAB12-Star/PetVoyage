<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/styleSheets/stars.css">

<!-- ===== HERO ===== -->
<div class="airline-hero py-5 text-center border-bottom">
  <h1 class="fw-bold display-5">Compare Pet Travel Policies Easily</h1>
  <p class="fs-5 text-muted">Select airline, view summary, explore sections, shop travel supplies.</p>
  <div class="mt-4">
    <%- include('../partials/navigation') %>
  </div>
</div>

<div class="container my-5">

  <!-- ===== AIRLINE HEADER ===== -->
  <div class="card shadow-sm mb-3 p-4">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div class="d-flex align-items-center gap-3">
        <% if (airline.logo) { %>
          <img src="<%= airline.logo %>" alt="<%= airline.name %> Logo" style="max-height:60px;object-fit:contain;">
        <% } %>
        <h2 class="h4 m-0"><strong><%= airline.name %></strong></h2>
      </div>

      <!-- Save Button -->
      <form method="POST" action="/favorites/saveAirlineToFavorites">
        <input type="hidden" name="airlineId" value="<%= airline._id %>">
        <button type="submit" class="btn btn-outline-danger fw-semibold">
          <i class="fas fa-heart me-1"></i> Save
        </button>
      </form>
    </div>

    <!-- Quick Stats Badges -->
    <div class="mt-3 d-flex flex-wrap gap-2">
      <% if (airline.inCompartmentAnimals?.length) { %>
        <span class="badge text-bg-secondary">In Compartment: <strong><%= airline.inCompartmentAnimals.join(', ') %></strong></span>
      <% } %>
      <% if (airline.inCargoAnimals?.length) { %>
        <span class="badge text-bg-secondary">In Cargo: <strong><%= airline.inCargoAnimals.join(', ') %></strong></span>
      <% } %>
      <% if (airline.petShipping !== undefined) { %>
        <span class="badge text-bg-secondary">Pet Shipping: <strong><%= airline.petShipping %></strong></span>
      <% } %>
      <% if (airline.microchip !== undefined) { %>
        <span class="badge text-bg-light border">Microchip: <strong><%= airline.microchip %></strong></span>
      <% } %>
      <% if (airline.healthCertificate !== undefined) { %>
        <span class="badge text-bg-light border">Health Certificate: <strong><%= airline.healthCertificate %></strong></span>
      <% } %>
      <% if (airline.healthVaccinations?.length) { %>
        <span class="badge text-bg-light border">Vaccinations: <strong><%= airline.healthVaccinations.join(', ') %></strong></span>
      <% } %>
      <% if (airline.petPolicyURL) { %>
    <a
      href="<%= airline.petPolicyURL %>"
      target="_blank"
      rel="noopener"
      class="badge text-bg-primary text-decoration-none fw-semibold"
    >
      Airline Pet Policy Link  </a>
  <% } %>
    </div>
  </div>

  <!-- ===== TOP DOG SHOPIFY AD ===== -->
<div class="card shadow-sm border border-warning overflow-hidden mb-4" 
     style="border-radius: 12px; background-color: #eaf6ff;">
  <div class="row align-items-center p-3">
    <div class="col-md-3 text-center">
      <img src="/images/DogTravelCollectionV2.jpg" alt="Dog Travel Supplies" 
           class="img-fluid rounded" style="max-width:200px;">
    </div>
    <div class="col-md-6 text-md-start text-center">
      <h3 class="fw-bold mb-2">Shop Dog Travel Supplies</h3>
      <p class="text-muted mb-0">Carriers, crates, harnesses, travel kits, medical bags â€” stress-free travel for dogs.</p>
    </div>
    <div class="col-md-3 text-md-end text-center mt-3 mt-md-0">
      <a href="https://petsvoyage.myshopify.com/collections/dog-travel" target="_blank" 
         class="btn btn-primary fw-bold px-4 py-2">Shop Now â†’</a>
    </div>
  </div>
</div>


  <!-- ===== SECTION NAV BUTTONS ===== -->
  <div class="row text-center g-3 mb-4">
    <div class="col-2"><a href="#summary"><div class="card shadow-sm p-3"><i class="bi bi-info-circle"></i><h6>Summary</h6></div></a></div>
    <div class="col-2"><a href="#health"><div class="card shadow-sm p-3"><i class="bi bi-heart-pulse"></i><h6>Health</h6></div></a></div>
    <div class="col-2"><a href="#restrictions"><div class="card shadow-sm p-3"><i class="bi bi-exclamation-triangle"></i><h6>Restrictions</h6></div></a></div>
    <div class="col-2"><a href="#support"><div class="card shadow-sm p-3"><i class="bi bi-paw-fill"></i><h6>Support</h6></div></a></div>
    <div class="col-2"><a href="#carrier"><div class="card shadow-sm p-3"><i class="bi bi-truck"></i><h6>Carrier</h6></div></a></div>
    <div class="col-2"><a href="#reviews"><div class="card shadow-sm p-3"><i class="bi bi-chat-dots"></i><h6>Reviews</h6></div></a></div>
  </div>

  <!-- ===== SUMMARY (2 Column Layout) ===== -->
  <div id="summary" class="row my-5">
    <div class="col-lg-8 col-md-7">
      <div class="card p-4 shadow-sm h-100">
        <h3 class="mb-3">
          <i class="bi bi-info-circle-fill me-2 text-primary"></i>Pet Policy Summary
        </h3>
        <div>
          <%- airline.ImprovedPetPolicySummary || 'Pet policy summary not available.' %>
        </div>
      </div>
    </div>

   <!-- ðŸ” Randomized Square Ad Spot -->
<div class="col-lg-4 col-md-5 mt-4 mt-md-0">
  <% 
    const adPartials = [
      '../partials/ads/taxiAd',
      '../partials/ads/conciergeAd',
   
    ];
    const randomAd = adPartials[Math.floor(Math.random() * adPartials.length)];
  %>
  <div class="card p-3 shadow-sm h-100 text-center">
    <%- include(randomAd) %>
  </div>
</div>


  <!-- ===== 2x2 SECTIONS ===== -->
  <div class="row gy-4">
    <section id="health" class="col-md-6">
      <div class="card border-start border-dark border-4 shadow-sm h-100 p-3">
        <h5><i class="bi bi-heart-pulse me-2"></i>Health Requirements</h5>
        <p><strong>Microchip:</strong> <%- airline.microchip || "Not specified." %></p>
        <p><strong>Health Certificate:</strong> <%- airline.healthCertificate || "Not specified." %></p>
        <p><strong>Vaccinations:</strong> <%- airline.healthVaccinations?.join(', ') || "Not specified." %></p>
     

</p>


      </div>
    </section>

    <section id="restrictions" class="col-md-6">
      <div class="card border-start border-dark border-4 shadow-sm h-100 p-3">
        <h5><i class="bi bi-exclamation-triangle me-2"></i>Restrictions</h5>
        <p><strong>Brachycephalic Breeds:</strong> <%- airline.brachycephalicBreedList || "Not specified." %></p>
        <p><strong>Dangerous Breeds:</strong> <%- airline.dangerousBreedList || "Not specified." %></p>
      </div>
    </section>

    <section id="support" class="col-md-6">
      <div class="card border-start border-dark border-4 shadow-sm h-100 p-3">
        <h5><i class="bi bi-paw me-2"></i>Support Animals</h5>
        <p><strong>Service Animals:</strong> <%- airline.serviceAnimalDetails || "Not specified." %></p>
        <p><strong>Emotional Support:</strong> <%- airline.esaDetails || "Not specified." %></p>
      </div>
    </section>

    <section id="carrier" class="col-md-6">
      <div class="card border-start border-dark border-4 shadow-sm h-100 p-3">
        <h5><i class="bi bi-truck me-2"></i>Carrier Details</h5>
        <p><strong>Compartment:</strong> <%- airline.carrierCompartmentDetails || "Not specified." %></p>
        <p><strong>Cargo:</strong> <%- airline.carrierCargoDetails || "Not specified." %></p>
      </div>
    </section>
  </div>

  <!-- ===== REVIEWS ===== -->
  <section id="reviews" class="mt-5">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h2>Reviews</h2>

        <!-- Review Form -->
        <form class="validated-form mb-3" method="POST" action="/airlines/<%= airline.slug %>/reviews">
          <fieldset class="starability-basic">
            <% for (let i = 1; i <= 5; i++) { %>
              <input type="radio" id="rate<%= i %>" name="review[rating]" value="<%= i %>" />
              <label for="rate<%= i %>"><%= i %> star</label>
            <% } %>
          </fieldset>
          <textarea class="form-control mt-2" name="review[body]" placeholder="Write your review..." required></textarea>
          <button class="btn btn-success mt-2">Submit Review</button>
        </form>

        <% const reviews = airline.reviews || []; %>
        <% if (reviews.length) { %>
          <% reviews.forEach(review => { %>
            <div class="card mb-3">
              <div class="card-body">
                <p class="text-muted mb-2">
                  <% for (let i = 1; i <= 5; i++) { %>
                    <i class="<%= i <= review.rating ? 'fas' : 'far' %> fa-star" style="color:#ffae00;"></i>
                  <% } %>
                </p>
                <p class="mb-2">
                  <strong><%= review.author?.name || review.author?.username || '' %></strong>: 
                  <%= review.body %>
                </p>
                <% if (currentUser && review.author && String(review.author._id) === String(currentUser._id)) { %>
                  <form method="POST" action="/airlines/slug/<%= airline.slug %>/reviews/<%= review._id %>?_method=DELETE">
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </form>
                <% } %>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p class="text-muted">No reviews yet. Be the first to leave a review!</p>
        <% } %>
      </div>
    </div>
  </section>

  <!-- ===== CAT AD AT BOTTOM ===== -->
  <div class="card shadow-sm border border-warning overflow-hidden mb-4 mt-4" style="border-radius: 12px;">
    <div class="row align-items-center p-3">
      <div class="col-md-3 text-center">
        <img src="/images/CatTravelCollection.jpg" alt="Cat Travel Supplies" class="img-fluid rounded" style="max-width:200px;">
      </div>
      <div class="col-md-6 text-md-start text-center">
        <h3 class="fw-bold mb-2">Shop Cat Travel Supplies</h3>
        <p class="text-muted mb-0">Carriers, calming oils, seat boosters, backpacks â€” stress-free cat travel.</p>
      </div>
      <div class="col-md-3 text-md-end text-center mt-3 mt-md-0">
        <a href="https://petsvoyage.myshopify.com/collections/cat-travel" target="_blank" class="btn btn-primary fw-bold px-4 py-2">Shop Now â†’</a>
      </div>
    </div>
  </div>

</div>

<script>
function validateReviewForm() {
  return !!document.querySelector('input[name="review[rating]"]:checked');
}
</script>
